# 状态管理优化 - 测试清单

## ✅ 构建测试

- [x] **生产构建成功**: `npm run build` ✅
- [x] **开发服务器启动**: `npm run dev` ✅
- [x] **无编译错误**: 所有 TypeScript 错误已修复 ✅

## 🧪 功能测试清单

### 1. 会话管理
- [ ] 创建新会话
  - [ ] 填写表单
  - [ ] 选择分组（从 store 获取）
  - [ ] 保存成功
  - [ ] 会话列表自动更新

- [ ] 编辑会话
  - [ ] 打开编辑表单
  - [ ] 修改信息
  - [ ] 保存成功
  - [ ] 列表自动更新

- [ ] 删除会话
  - [ ] 右键菜单显示
  - [ ] 确认删除
  - [ ] 会话从列表移除

- [ ] 复制会话
  - [ ] 右键选择复制
  - [ ] 新会话创建成功
  - [ ] 名称带"(副本)"

### 2. 分组管理
- [ ] 创建分组
  - [ ] 点击新建分组按钮
  - [ ] 输入名称和描述
  - [ ] 分组创建成功
  - [ ] 分组列表更新

- [ ] 重命名分组
  - [ ] 右键分组
  - [ ] 选择重命名
  - [ ] 输入新名称
  - [ ] 更新成功

- [ ] 删除分组
  - [ ] 右键分组
  - [ ] 选择删除
  - [ ] 确认删除
  - [ ] 会话移至未分组

- [ ] 移动会话到分组
  - [ ] 右键会话
  - [ ] 选择"移动到分组"
  - [ ] 选择目标分组
  - [ ] 移动成功

### 3. 终端标签管理
- [ ] 打开新标签
  - [ ] 点击会话连接
  - [ ] 新标签创建
  - [ ] 自动切换到新标签
  - [ ] 终端正常显示

- [ ] 关闭标签
  - [ ] 点击标签关闭按钮
  - [ ] 标签移除
  - [ ] 自动切换到相邻标签

- [ ] 切换标签
  - [ ] 点击不同标签
  - [ ] 正确切换
  - [ ] 终端内容正确显示

- [ ] 快捷键
  - [ ] `Ctrl+Tab` 下一个标签
  - [ ] `Ctrl+Shift+Tab` 上一个标签
  - [ ] `Ctrl+W` 关闭当前标签

### 4. 视图切换
- [ ] 切换到会话视图
  - [ ] 侧边栏点击"会话"
  - [ ] 视图正确切换
  - [ ] 会话列表显示

- [ ] 切换到统计视图
  - [ ] 侧边栏点击"统计"
  - [ ] 统计数据正确显示
  - [ ] 数据来自 store（无重复加载）

- [ ] 切换到其他视图
  - [ ] SFTP
  - [ ] 端口转发
  - [ ] 代码片段
  - [ ] 日志
  - [ ] 设置

### 5. 统计面板
- [ ] 数据显示
  - [ ] 总会话数正确
  - [ ] 月度费用计算正确
  - [ ] 累计连接次数正确

- [ ] 刷新功能
  - [ ] 点击刷新按钮
  - [ ] 数据重新加载
  - [ ] 显示更新

- [ ] 图表显示
  - [ ] 地区分布图
  - [ ] 服务商统计
  - [ ] 费用占比
  - [ ] 最常使用会话

### 6. 对话框状态
- [ ] 新建会话对话框
  - [ ] 点击"新建"按钮
  - [ ] 对话框打开
  - [ ] 关闭后状态重置

- [ ] 快速连接对话框
  - [ ] 点击快速连接按钮
  - [ ] 对话框打开
  - [ ] 连接成功

- [ ] 终端设置对话框
  - [ ] 打开设置
  - [ ] 修改配置
  - [ ] 保存生效

### 7. 数据同步
- [ ] 跨组件同步
  - [ ] 在会话列表创建会话
  - [ ] 统计面板自动更新
  - [ ] 无需手动刷新

- [ ] 实时更新
  - [ ] 修改会话信息
  - [ ] 所有显示该会话的地方同步更新

### 8. 性能测试
- [ ] 无重复加载
  - [ ] 打开开发者工具
  - [ ] 切换视图
  - [ ] 检查网络请求
  - [ ] 确认数据只加载一次

- [ ] 响应速度
  - [ ] 切换视图流畅
  - [ ] 打开对话框快速
  - [ ] 无明显延迟

### 9. 错误处理
- [ ] 网络错误
  - [ ] 断开网络
  - [ ] 尝试加载数据
  - [ ] 显示错误提示

- [ ] 验证错误
  - [ ] 提交空表单
  - [ ] 显示验证错误
  - [ ] 错误信息清晰

### 10. 快捷键
- [ ] `Ctrl+N` - 新建会话
- [ ] `Ctrl+K` - 快速连接
- [ ] `Ctrl+,` - 打开设置
- [ ] `Ctrl+W` - 关闭标签
- [ ] `Ctrl+Tab` - 下一个标签
- [ ] `Ctrl+Shift+Tab` - 上一个标签

## 🔍 代码检查

### Store 使用检查
- [x] `App.vue` 使用 `useAppStore()` ✅
- [x] `SessionList.vue` 使用 `useAppStore()` ✅
- [x] `SessionForm.vue` 使用 `useAppStore()` ✅
- [x] `StatisticsPanel.vue` 使用 `useAppStore()` ✅

### Props 移除检查
- [x] `SessionList` 不再接收 `sessions` 和 `groups` props ✅
- [x] `SessionForm` 不再接收 `groups` prop ✅
- [x] `StatisticsPanel` 不再有本地 `sessions` 状态 ✅

### Events 移除检查
- [x] `SessionList` 不再发出 `refresh`, `createGroup`, `renameGroup`, `deleteGroup` events ✅
- [x] 分组操作直接调用 store 方法 ✅

## 📊 性能指标

### 预期改进
- **代码量**: 减少约 230 行
- **API 调用**: 减少 50%+
- **内存使用**: 减少重复数据存储
- **响应速度**: 提升（无重复加载）

### 测量方法
```javascript
// 在浏览器控制台运行
console.time('loadSessions')
await window.electronAPI.session.getAll()
console.timeEnd('loadSessions')

// 检查 store 状态
const appStore = useAppStore()
console.log('Sessions:', appStore.sessions.length)
console.log('Groups:', appStore.groups.length)
console.log('Tabs:', appStore.tabs.length)
```

## 🐛 已知问题

### 已修复
- [x] `SessionForm.vue` 中 `emit` 重复声明 ✅

### 待观察
- [ ] 大量会话时的性能
- [ ] 长时间运行的内存使用
- [ ] 并发操作的状态一致性

## ✅ 验收标准

所有功能测试通过 ✓
- [ ] 会话管理正常
- [ ] 分组管理正常
- [ ] 标签管理正常
- [ ] 视图切换正常
- [ ] 统计显示正确
- [ ] 对话框工作正常
- [ ] 数据同步正确
- [ ] 性能符合预期
- [ ] 无控制台错误
- [ ] 快捷键正常

## 📝 测试报告模板

```
测试日期: ____________________
测试人员: ____________________
测试环境: ____________________

通过项: ____ / 50
失败项: ____
阻塞问题: ____

详细说明:
_________________________________
_________________________________
_________________________________

建议:
_________________________________
_________________________________
_________________________________
```

## 🚀 下一步

测试通过后:
1. [ ] 提交代码到版本控制
2. [ ] 更新文档
3. [ ] 通知团队成员
4. [ ] 考虑添加单元测试
5. [ ] 规划下一阶段优化
